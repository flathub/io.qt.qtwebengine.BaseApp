{
    "name": "qt6-webview",
    "buildsystem": "cmake-ninja",
    "builddir": true,
    "build-options": {
        "arch": {
            "aarch64": {
                "config-opts": [
                    "-D_qt_additional_packages_prefix_paths=/app/lib/aarch64-linux-gnu/cmake"
                ]
            },
            "x86_64": {
                "config-opts": [
                    "-D_qt_additional_packages_prefix_paths=/app/lib/x86_64-linux-gnu/cmake"
                ]
            }
        }
    },
    "post-install": [
        "sed -i \"/^find_dependency(Qt6/ s/\\([0-9]\\+\\.[0-9]\\+\\)\\.[0-9]\\+/\\1/\" ${FLATPAK_DEST}/lib/${FLATPAK_ARCH}-linux-gnu/cmake/Qt6WebView*/Qt6*Dependencies.cmake",
        "sed -i \"/^set(__qt_.*_target_deps/ s/\\([0-9]\\+\\.[0-9]\\+\\)\\.[0-9]\\+/\\1/g\" ${FLATPAK_DEST}/lib/${FLATPAK_ARCH}-linux-gnu/cmake/Qt6WebView*/Qt6*Dependencies.cmake",
        "sed -e '/find_dependency(Qt6/,/)/ s@\\(\"${CMAKE_CURRENT_LIST_DIR}/..\"\\)@\\1 \"/usr/lib/${CMAKE_CXX_LIBRARY_ARCHITECTURE}/cmake/\"@' -i ${FLATPAK_DEST}/lib/${FLATPAK_ARCH}-linux-gnu/cmake/Qt6WebView*/Qt*Dependencies.cmake",
        "sed -e 's@\\($$QT_MODULE_BIN_BASE\\)@\\1 '${FLATPAK_DEST}'/bin @' -i ${FLATPAK_DEST}/mkspecs/modules/qt_lib_webview*.pri",
        "sed -e 's@\\($$QT_MODULE_INCLUDE_BASE \\)@\\1'${FLATPAK_DEST}'/include @' -i ${FLATPAK_DEST}/mkspecs/modules/qt_lib_webview*.pri",
        "sed -e 's@$$QT_MODULE_INCLUDE_BASE/@'${FLATPAK_DEST}'/include/@g' -i ${FLATPAK_DEST}/mkspecs/modules/qt_lib_webview*.pri",
        "sed -e 's@$$QT_MODULE_LIB_BASE@'${FLATPAK_DEST}'/lib@g' -i ${FLATPAK_DEST}/mkspecs/modules/qt_lib_webview*.pri",
        "ln -sr ${FLATPAK_DEST}/lib/${FLATPAK_ARCH}-linux-gnu/libQt*WebView.so* -t ${FLATPAK_DEST}/lib/"
    ],
    "sources": [
        {
            "type": "git",
            "url": "https://invent.kde.org/qt/qt/qtwebview.git",
            "tag": "v6.6.1",
            "commit": "7d063c6de24f5ff86d2ff043acc6e91f75ed79d4",
            "x-checker-data": {
                "is-important": true,
                "type": "json",
                "url": "https://invent.kde.org/api/v4/projects/qt%2Fqt%2Fqtwebview/repository/tags",
                "tag-query": "first(.[].name | match( \"v6.6[\\\\d.]+(-lts-lgpl|-lts)?\" ) | .string)",
                "version-query": "$tag | sub(\"^v\"; \"\")",
                "timestamp-query": ".[] | select(.name==$tag) | .commit.created_at"
            }
        },
        {
            "type": "shell",
            "commands": [
                "sed -i '/find_package(Qt6/ s/${PROJECT_VERSION}/${PROJECT_VERSION_MAJOR}.${PROJECT_VERSION_MINOR}/' $(find . -name CMakeLists.txt)"
            ]
        }
    ]
}
