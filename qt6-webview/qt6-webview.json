{
    "name": "qt6-webview",
    "buildsystem": "cmake-ninja",
    "builddir": true,
    "build-options": {
        "arch": {
            "aarch64": {
                "config-opts": [
                    "-D_qt_additional_packages_prefix_paths=/app/lib/aarch64-linux-gnu/cmake"
                ]
            },
            "x86_64": {
                "config-opts": [
                    "-D_qt_additional_packages_prefix_paths=/app/lib/x86_64-linux-gnu/cmake"
                ]
            }
        }
    },
    "post-install": [
        "../cmake_qtver_req_fix.sh",
        "sed -e '/find_dependency(Qt6/,/)/ s@\\(\"${CMAKE_CURRENT_LIST_DIR}/..\"\\)@\\1 \"/usr/lib/${CMAKE_CXX_LIBRARY_ARCHITECTURE}/cmake/\"@' -i ${FLATPAK_DEST}/lib/${FLATPAK_ARCH}-linux-gnu/cmake/Qt6WebView*/Qt*Dependencies.cmake",
        "sed -e 's@\\($$QT_MODULE_BIN_BASE\\)@\\1 '${FLATPAK_DEST}'/bin @' -i ${FLATPAK_DEST}/mkspecs/modules/qt_lib_webview*.pri",
        "sed -e 's@\\($$QT_MODULE_INCLUDE_BASE \\)@\\1'${FLATPAK_DEST}'/include @' -i ${FLATPAK_DEST}/mkspecs/modules/qt_lib_webview*.pri",
        "sed -e 's@$$QT_MODULE_INCLUDE_BASE/@'${FLATPAK_DEST}'/include/@g' -i ${FLATPAK_DEST}/mkspecs/modules/qt_lib_webview*.pri",
        "sed -e 's@$$QT_MODULE_LIB_BASE@'${FLATPAK_DEST}'/lib@g' -i ${FLATPAK_DEST}/mkspecs/modules/qt_lib_webview*.pri"
    ],
    "sources": [
        {
            "type": "git",
            "url": "https://invent.kde.org/qt/qt/qtwebview.git",
            "tag": "v6.2.2",
            "commit": "953f085e79dae4566fc641e4266e086890bd4aba",
            "x-checker-data": {
                "is-main-source": true,
                "type": "json",
                "url": "https://invent.kde.org/api/v4/projects/qt%2Fqt%2Fqtwebview/repository/tags",
                "tag-query": "first(.[].name | match( \"v6.2[\\\\d.]+-lts|v6.2[\\\\d.]+\" ) | .string)",
                "version-query": "$tag | sub(\"^v\"; \"\")",
                "timestamp-query": ".[] | select(.name==$tag) | .commit.created_at"
            }
        },
        {
            "type": "script",
            "dest-filename": "cmake_qtver_req_fix.sh",
            "commands": [
                "cmake_mod_path=${FLATPAK_DEST}/lib/${FLATPAK_ARCH}-linux-gnu/cmake",
                "qtver=$(qmake -query QT_VERSION)",
                "qtver0=$(echo $qtver | cut -d. -f1)",
                "qtver1=$(echo $qtver | cut -d. -f2)",
                "qtver_comm=${qtver0}.${qtver1}",
                "sed -i \"/^find_dependency(Qt6/ s/${qtver0}\\.${qtver1}\\.[0-9]\\+/${qtver_comm}/\" ${cmake_mod_path}/Qt6WebView*/Qt6*Dependencies.cmake",
                "sed -i \"/^set(__qt_.*_target_deps/ s/${qtver0}\\.${qtver1}\\.[0-9]\\+/${qtver_comm}/g\" ${cmake_mod_path}/Qt6WebView*/Qt6*Dependencies.cmake"
            ]
        },
        {
            "type": "shell",
            "commands": [
                "sed -i '/find_package(Qt6/ s/${PROJECT_VERSION}/${PROJECT_VERSION_MAJOR}.${PROJECT_VERSION_MINOR}/' $(find . -name CMakeLists.txt)"
            ]
        }
    ]
}
